<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Atomic Swap | Documentation</title>
    <meta name="description" content="Secure smart contracts">
    <link rel="icon" href="/documentation/favicon-full.ico">
  <script>
    const logoUrlChanger = setInterval(function() {
    //Anchor above the logo image
    const homeEls = document.getElementsByClassName("home-link");
    if(homeEls.length > 0) {
      const homeEl = homeEls[0];
      homeEl.setAttribute("href", "https://agoric.com");
      homeEl.setAttribute("onclick", "return false;");
      clearInterval(logoUrlChanger);
    }

    //Actual logo image
    const logoEls = document.getElementsByClassName("logo")
    if(logoEls.length > 0) {
      const logoEl = logoEls[0]
      logoEl.setAttribute("onclick", "document.location='https://agoric.com';return false;");
      clearInterval(logoUrlChanger);
    }
   }, 1000) </script>
    
    <link rel="preload" href="/documentation/assets/css/0.styles.67a138ae.css" as="style"><link rel="preload" href="/documentation/assets/js/app.58389949.js" as="script"><link rel="preload" href="/documentation/assets/js/2.a254c233.js" as="script"><link rel="preload" href="/documentation/assets/js/46.f8dc464b.js" as="script"><link rel="preload" href="/documentation/assets/js/10.373fe68a.js" as="script"><link rel="prefetch" href="/documentation/assets/js/11.df381bf0.js"><link rel="prefetch" href="/documentation/assets/js/12.c655e22b.js"><link rel="prefetch" href="/documentation/assets/js/13.0d89ddb0.js"><link rel="prefetch" href="/documentation/assets/js/14.f95b7a8b.js"><link rel="prefetch" href="/documentation/assets/js/15.87339499.js"><link rel="prefetch" href="/documentation/assets/js/16.54d3fc52.js"><link rel="prefetch" href="/documentation/assets/js/17.c68cedf0.js"><link rel="prefetch" href="/documentation/assets/js/18.5c67c8f7.js"><link rel="prefetch" href="/documentation/assets/js/19.79b98ca6.js"><link rel="prefetch" href="/documentation/assets/js/20.a1c151ab.js"><link rel="prefetch" href="/documentation/assets/js/21.afe8edca.js"><link rel="prefetch" href="/documentation/assets/js/22.ea0988fe.js"><link rel="prefetch" href="/documentation/assets/js/23.8b78fd4a.js"><link rel="prefetch" href="/documentation/assets/js/24.7500a6c4.js"><link rel="prefetch" href="/documentation/assets/js/25.66da6e54.js"><link rel="prefetch" href="/documentation/assets/js/26.f0610b77.js"><link rel="prefetch" href="/documentation/assets/js/27.b498d103.js"><link rel="prefetch" href="/documentation/assets/js/28.ca592c45.js"><link rel="prefetch" href="/documentation/assets/js/29.130a2a77.js"><link rel="prefetch" href="/documentation/assets/js/3.be75a914.js"><link rel="prefetch" href="/documentation/assets/js/30.bc398b1b.js"><link rel="prefetch" href="/documentation/assets/js/31.c80ae848.js"><link rel="prefetch" href="/documentation/assets/js/32.9678e29e.js"><link rel="prefetch" href="/documentation/assets/js/33.bef97cc6.js"><link rel="prefetch" href="/documentation/assets/js/34.00154ce5.js"><link rel="prefetch" href="/documentation/assets/js/35.bdc65370.js"><link rel="prefetch" href="/documentation/assets/js/36.d16d0c0a.js"><link rel="prefetch" href="/documentation/assets/js/37.5b989a6c.js"><link rel="prefetch" href="/documentation/assets/js/38.f85e0982.js"><link rel="prefetch" href="/documentation/assets/js/39.95b30e04.js"><link rel="prefetch" href="/documentation/assets/js/4.70f5523b.js"><link rel="prefetch" href="/documentation/assets/js/40.4c6fec6a.js"><link rel="prefetch" href="/documentation/assets/js/41.9621cd4e.js"><link rel="prefetch" href="/documentation/assets/js/42.84f38d25.js"><link rel="prefetch" href="/documentation/assets/js/43.2f8624e1.js"><link rel="prefetch" href="/documentation/assets/js/44.ec845449.js"><link rel="prefetch" href="/documentation/assets/js/45.06c458fd.js"><link rel="prefetch" href="/documentation/assets/js/47.2ce918a1.js"><link rel="prefetch" href="/documentation/assets/js/48.d1f4a03d.js"><link rel="prefetch" href="/documentation/assets/js/49.1232047b.js"><link rel="prefetch" href="/documentation/assets/js/5.8345da13.js"><link rel="prefetch" href="/documentation/assets/js/50.6e8efc34.js"><link rel="prefetch" href="/documentation/assets/js/51.116014d6.js"><link rel="prefetch" href="/documentation/assets/js/52.a9997e08.js"><link rel="prefetch" href="/documentation/assets/js/53.a673d1fb.js"><link rel="prefetch" href="/documentation/assets/js/54.d024ce11.js"><link rel="prefetch" href="/documentation/assets/js/6.a59a403a.js"><link rel="prefetch" href="/documentation/assets/js/7.d06c5025.js"><link rel="prefetch" href="/documentation/assets/js/8.be72feb5.js"><link rel="prefetch" href="/documentation/assets/js/9.d38ae586.js">
    <link rel="stylesheet" href="/documentation/assets/css/0.styles.67a138ae.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/documentation/" class="home-link router-link-active"><img src="/documentation/logo.svg" alt="Documentation" class="logo"> <span class="site-name can-hide">Documentation</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Getting Started Menu" class="dropdown-title"><span class="title">Getting Started</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/documentation/getting-started/" class="nav-link">Agoric Dev Tools</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ERTP Menu" class="dropdown-title"><span class="title">ERTP</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/documentation/ertp/guide/" class="nav-link">Guide</a></li><li class="dropdown-item"><!----> <a href="/documentation/ertp/api/" class="nav-link">API</a></li><li class="dropdown-item"><!----> <a href="https://github.com/Agoric/agoric-sdk/tree/master/packages/ERTP" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Zoe Menu" class="dropdown-title"><span class="title">Zoe</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/documentation/zoe/guide/" class="nav-link router-link-active">Guide</a></li><li class="dropdown-item"><!----> <a href="/documentation/zoe/guide/contracts/autoswap.html" class="nav-link">Contracts</a></li><li class="dropdown-item"><!----> <a href="/documentation/zoe/api/" class="nav-link">API</a></li><li class="dropdown-item"><!----> <a href="https://github.com/Agoric/agoric-sdk/tree/master/packages/zoe" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><a href="/documentation/dapps/" class="nav-link">Dapp Guide</a></div><div class="nav-item"><a href="/documentation/glossary/" class="nav-link">Glossary</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Learn More Menu" class="dropdown-title"><span class="title">Learn More</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/documentation/miscellaneous/contributing.html" class="nav-link">Contributing</a></li><li class="dropdown-item"><!----> <a href="https://agoric.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Agoric
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><a href="https://github.com/Agoric/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Getting Started Menu" class="dropdown-title"><span class="title">Getting Started</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/documentation/getting-started/" class="nav-link">Agoric Dev Tools</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ERTP Menu" class="dropdown-title"><span class="title">ERTP</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/documentation/ertp/guide/" class="nav-link">Guide</a></li><li class="dropdown-item"><!----> <a href="/documentation/ertp/api/" class="nav-link">API</a></li><li class="dropdown-item"><!----> <a href="https://github.com/Agoric/agoric-sdk/tree/master/packages/ERTP" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Zoe Menu" class="dropdown-title"><span class="title">Zoe</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/documentation/zoe/guide/" class="nav-link router-link-active">Guide</a></li><li class="dropdown-item"><!----> <a href="/documentation/zoe/guide/contracts/autoswap.html" class="nav-link">Contracts</a></li><li class="dropdown-item"><!----> <a href="/documentation/zoe/api/" class="nav-link">API</a></li><li class="dropdown-item"><!----> <a href="https://github.com/Agoric/agoric-sdk/tree/master/packages/zoe" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><a href="/documentation/dapps/" class="nav-link">Dapp Guide</a></div><div class="nav-item"><a href="/documentation/glossary/" class="nav-link">Glossary</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Learn More Menu" class="dropdown-title"><span class="title">Learn More</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/documentation/miscellaneous/contributing.html" class="nav-link">Contributing</a></li><li class="dropdown-item"><!----> <a href="https://agoric.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Agoric
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><a href="https://github.com/Agoric/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><a href="/documentation/zoe/guide/" class="sidebar-heading clickable router-link-active"><span>Zoe</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/documentation/zoe/guide/" class="sidebar-link">Zoe: Offer-Safety Enforcement</a></li><li><a href="/documentation/zoe/guide/offer-safety.html" class="sidebar-link">Offer Safety</a></li><li><a href="/documentation/zoe/guide/proposal.html" class="sidebar-link">The Structure of Proposals</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/documentation/zoe/guide/contracts/" class="sidebar-heading clickable router-link-active open"><span>Zoe Contracts</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/documentation/zoe/guide/contracts/atomic-swap.html" class="active sidebar-link">Atomic Swap</a></li><li><a href="/documentation/zoe/guide/contracts/autoswap.html" class="sidebar-link">AutoSwap</a></li><li><a href="/documentation/zoe/guide/contracts/covered-call.html" class="sidebar-link">Covered Call</a></li><li><a href="/documentation/zoe/guide/contracts/second-price-auction.html" class="sidebar-link">Second-price auction</a></li><li><a href="/documentation/zoe/guide/contracts/simple-exchange.html" class="sidebar-link">Simple Exchange</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/documentation/zoe/api/" class="sidebar-heading clickable"><span>Zoe API</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/documentation/zoe/api/zoe.html" class="sidebar-link">Zoe</a></li><li><a href="/documentation/zoe/api/records.html" class="sidebar-link">Records</a></li><li><a href="/documentation/zoe/api/zoe-contract-facet.html" class="sidebar-link">Zoe Contract Facet</a></li><li><a href="/documentation/zoe/api/zoe-helpers.html" class="sidebar-link">ZoeHelpers</a></li></ul></section></li><li><a href="/documentation/zoe/roadmap/" class="sidebar-link">Zoe Roadmap</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="atomic-swap"><a href="#atomic-swap" class="header-anchor">#</a> Atomic Swap</h1> <div class="zoe-version">
    Zoe v0.3.0. Last updated
    3/24/2020.
</div> <p>If I want to trade one kind of asset for another kind, I could send
you the asset and ask you to send me the other kind back. But, you
could choose to behave opportunistically: receive my asset and give
nothing back. To solve this problem, swap contracts allow users to
securely trade one kind of digital asset for another kind, leveraging Zoe for
escrow and offer safety. At no time does any user have the ability to
behave opportunistically.</p> <p>In the <code>atomicSwap</code> contract, anyone can securely swap with a counterparty by escrowing digital assets with Zoe and sending an invite to the swap to the counterparty.</p> <p>Let's say that Alice wants to swap with Bob as the counterparty. She
knows that the code for the swap has already been installed, so she
can create a swap instance from the swap installation (<code>handle</code> is the
unique, unforgeable identifier):</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> issuerKeywordRecord <span class="token operator">=</span> <span class="token function">harden</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  Asset<span class="token operator">:</span> moolaIssuer<span class="token punctuation">,</span>
  Price<span class="token operator">:</span> simoleanIssuer<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> newInvite <span class="token operator">=</span> <span class="token keyword">await</span> zoe<span class="token punctuation">.</span><span class="token function">makeInstance</span><span class="token punctuation">(</span>
  installationHandle<span class="token punctuation">,</span>
  issuerKeywordRecord<span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Then she escrows her offer with Zoe. When she escrows, she passes in
two things, the actual ERTP payments that are part of her offer, and
an object called <code>Proposal</code>. The <code>Proposal</code> will be used by Zoe to
protect Alice from the smart contract and other participants. The
<code>Proposal</code> has three parts: <code>give</code> and <code>want</code>, which is used for
enforcing offer safety, and <code>exit</code>, which is used to enforce
exit safety. In this case, Alice's exit rule is <code>onDemand</code>, meaning
that she can exit at any time.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> moola <span class="token operator">=</span> moolaAmountMath<span class="token punctuation">.</span>make<span class="token punctuation">;</span>
<span class="token keyword">const</span> simoleans <span class="token operator">=</span> simoleanAmountMath<span class="token punctuation">.</span>make<span class="token punctuation">;</span>

<span class="token keyword">const</span> aliceProposal <span class="token operator">=</span> <span class="token function">harden</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  give<span class="token operator">:</span> <span class="token punctuation">{</span> Asset<span class="token operator">:</span> <span class="token function">moola</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  want<span class="token operator">:</span> <span class="token punctuation">{</span> Price<span class="token operator">:</span> <span class="token function">simoleans</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  exit<span class="token operator">:</span> <span class="token punctuation">{</span> onDemand<span class="token operator">:</span> <span class="token keyword">null</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> alicePayments <span class="token operator">=</span> <span class="token punctuation">{</span> Asset<span class="token operator">:</span> aliceMoolaPayment <span class="token punctuation">}</span>
</code></pre></div><p>In order for Alice to escrow with Zoe she needs to redeem her invite. Once Alice redeems her invite she will receive a <code>seat</code> and a promise that resolves to her payout.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> seat<span class="token operator">:</span> aliceSeat<span class="token punctuation">,</span> payout<span class="token operator">:</span> alicePayoutP <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> zoe<span class="token punctuation">.</span><span class="token function">redeem</span><span class="token punctuation">(</span>
  aliceInvite<span class="token punctuation">,</span>
  aliceProposal<span class="token punctuation">,</span>
  alicePayments<span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Alice then makes the first offer in the swap:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> newInviteP <span class="token operator">=</span> aliceSeat<span class="token punctuation">.</span><span class="token function">makeFirstOffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>She then sends the invite to Bob and he looks up the invite to see if it matches Alice's claims.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> inviteIssuer <span class="token operator">=</span> zoe<span class="token punctuation">.</span><span class="token function">getInviteIssuer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> bobExclusiveInvite <span class="token operator">=</span> <span class="token keyword">await</span> inviteIssuer<span class="token punctuation">.</span><span class="token function">claim</span><span class="token punctuation">(</span>newInviteP<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> bobInviteExtent <span class="token operator">=</span> inviteIssuer<span class="token punctuation">.</span><span class="token function">getAmountOf</span><span class="token punctuation">(</span>bobExclusiveInvite<span class="token punctuation">)</span>
  <span class="token punctuation">.</span>extent<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span>
  installationHandle<span class="token operator">:</span> bobInstallationId<span class="token punctuation">,</span>
  issuerKeywordRecord<span class="token operator">:</span> bobIssuers<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token operator">=</span> zoe<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>bobInviteExtent<span class="token punctuation">.</span>instanceHandle<span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">// Bob does checks</span>
<span class="token function">assert</span><span class="token punctuation">(</span>bobInstallationId <span class="token operator">===</span> installationHandle<span class="token punctuation">,</span> details<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">wrong installation</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">assert</span><span class="token punctuation">(</span>bobIssuers<span class="token punctuation">.</span>Asset <span class="token operator">===</span> moolaIssuer<span class="token punctuation">,</span> details<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">unexpected Asset issuer</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">assert</span><span class="token punctuation">(</span>bobIssuers<span class="token punctuation">.</span>Price <span class="token operator">===</span> simoleanIssuer<span class="token punctuation">,</span> details<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">unexpected Price issuer</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">assert</span><span class="token punctuation">(</span>moolaAmountMath<span class="token punctuation">.</span><span class="token function">isEqual</span><span class="token punctuation">(</span>bobInviteExtent<span class="token punctuation">.</span>asset<span class="token punctuation">,</span> <span class="token function">moola</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> details<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">wrong asset</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">assert</span><span class="token punctuation">(</span>simoleanAmountMath<span class="token punctuation">.</span><span class="token function">isEqual</span><span class="token punctuation">(</span>bobInviteExtent<span class="token punctuation">.</span>price<span class="token punctuation">,</span> <span class="token function">simoleans</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> details<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">wrong price</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Bob decides to be the counter-party. He also escrows his payments and redeems his invite to
make an offer in the same way as Alice, but his <code>Proposal</code> match Alice's:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> bobProposal <span class="token operator">=</span> <span class="token function">harden</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  want<span class="token operator">:</span> <span class="token punctuation">{</span> Asset<span class="token operator">:</span> <span class="token function">moola</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  give<span class="token operator">:</span> <span class="token punctuation">{</span> Price<span class="token operator">:</span> <span class="token function">simoleans</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  exit<span class="token operator">:</span> <span class="token punctuation">{</span> onDemand<span class="token operator">:</span> <span class="token keyword">null</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// Bob escrows with zoe</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> seat<span class="token operator">:</span> bobSeat<span class="token punctuation">,</span> payout<span class="token operator">:</span> bobPayoutP <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> zoe<span class="token punctuation">.</span><span class="token function">redeem</span><span class="token punctuation">(</span>
  bobExclusiveInvite<span class="token punctuation">,</span>
  bobProposal<span class="token punctuation">,</span>
  bobPayments<span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Bob makes an offer</span>
<span class="token keyword">const</span> bobOfferResult <span class="token operator">=</span> <span class="token keyword">await</span> bobSeat<span class="token punctuation">.</span><span class="token function">matchOffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Now that Bob has made his offer, the contract executes and Alice's
payout resolves to a a record with keyword keys
of ERTP payments <code>{ Asset: moola(0), Price: simoleans(7) }</code> where the
moolaPayment is empty, and the simoleanPayment has a balance of 7.</p> <p>The same is true for Bob, but for his specific payout.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> bobPayout <span class="token operator">=</span> <span class="token keyword">await</span> bobPayoutP<span class="token punctuation">;</span>
<span class="token keyword">const</span> alicePayout <span class="token operator">=</span> <span class="token keyword">await</span> alicePayoutP<span class="token punctuation">;</span>

<span class="token keyword">const</span> bobMoolaPayout <span class="token operator">=</span> <span class="token keyword">await</span> bobPayout<span class="token punctuation">.</span>Asset<span class="token punctuation">;</span>
<span class="token keyword">const</span> bobSimoleanPayout <span class="token operator">=</span> <span class="token keyword">await</span> bobPayout<span class="token punctuation">.</span>Price<span class="token punctuation">;</span>

<span class="token keyword">const</span> aliceMoolaPayout <span class="token operator">=</span> <span class="token keyword">await</span> alicePayout<span class="token punctuation">.</span>Asset<span class="token punctuation">;</span>
<span class="token keyword">const</span> aliceSimoleanPayout <span class="token operator">=</span> <span class="token keyword">await</span> alicePayout<span class="token punctuation">.</span>Price<span class="token punctuation">;</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/documentation/zoe/guide/proposal.html" class="prev">The Structure of Proposals</a></span> <span class="next"><a href="/documentation/zoe/guide/contracts/autoswap.html">AutoSwap</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/documentation/assets/js/app.58389949.js" defer></script><script src="/documentation/assets/js/2.a254c233.js" defer></script><script src="/documentation/assets/js/46.f8dc464b.js" defer></script><script src="/documentation/assets/js/10.373fe68a.js" defer></script>
  </body>
</html>
