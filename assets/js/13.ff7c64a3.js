(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{215:function(t,e,a){"use strict";a.r(e);var s=a(0),r=Object(s.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"distributed-programming-in-javascript"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#distributed-programming-in-javascript"}},[t._v("#")]),t._v(" Distributed programming in JavaScript")]),t._v(" "),a("p",[t._v("Agoric's platform is built mainly in JavaScript and enables authors to write secure smart contracts in JavaScript.")]),t._v(" "),a("p",[t._v("For the biggest part, all JavaScript knowledge is directly applicable to the Agoric platform. However, there are a couple of Agoric-specific additions at various layers that are better to understand before programming on the Agoric platform.")]),t._v(" "),a("p",[t._v("Some specificities are "),a("strong",[t._v("concepts")]),t._v(", other are at the "),a("strong",[t._v("syntax level")]),t._v(", others are "),a("strong",[t._v("Agoric library additions")]),t._v(".")]),t._v(" "),a("h2",{attrs:{id:"vats"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#vats"}},[t._v("#")]),t._v(" Vats")]),t._v(" "),a("p",[t._v("A vat is a "),a("em",[t._v("unit of synchrony")]),t._v(". This means that within a JavaScript vat, objects and functions can communicate with one another synchronously.")]),t._v(" "),a("p",[t._v("A vat runs a single "),a("em",[t._v("event loop")]),t._v(".")]),t._v(" "),a("p",[t._v("A physical machine can run one or several vats. A blockchain can run one or several communicating vats.")]),t._v(" "),a("p",[t._v("Different vats can communicate by sending asynchronous messages to other vats.")]),t._v(" "),a("p",[t._v("A vat is the moral equivalent of a Unix Process.")]),t._v(" "),a("p",[t._v("The internal state of a vat can be stored in a persistent memory so that the vat can be turned off and later turned back on (on the same or a different physical machine) by loading the stored state.")]),t._v(" "),a("p",[t._v("In cosmic-swingset, several vats are started. Each vat hosts a service (registrar, zoe, etc.). Currently (April 2020), all contracts run in the Zoe vat, but eventually, each contract will run in its own dedicated vat.")]),t._v(" "),a("h2",{attrs:{id:"secure-ecmascript-ses"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#secure-ecmascript-ses"}},[t._v("#")]),t._v(" Secure EcmaScript (SES)")]),t._v(" "),a("p",[t._v("SES is a variant of "),a("a",{attrs:{href:"https://www.ecma-international.org/publications/standards/Ecma-262.htm",target:"_blank",rel:"noopener noreferrer"}},[t._v("EcmaScript"),a("OutboundLink")],1),t._v(" (the standard behind JavaScript - common to web browsers JavaScript and Node.js) that is secure in the sense of object capability security. This means that codes that runs in an immutable realm has no access to ambiant authority by default (no access to disk or network, etc.) and new authority can only be granted by the entity that loaded this code.")]),t._v(" "),a("p",[t._v("SES can be enabled via the "),a("a",{attrs:{href:"https://www.npmjs.com/package/@agoric/harden",target:"_blank",rel:"noopener noreferrer"}},[a("code",[t._v("ses")]),t._v(" package"),a("OutboundLink")],1),t._v(".")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("lockdown"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ses"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n \n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("lockdown")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// turns the current realm into an immutable realm")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// calling this function also adds a global Compartment constructor to create compartments")]),t._v("\n")])])]),a("h3",{attrs:{id:"compartments-and-realms"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#compartments-and-realms"}},[t._v("#")]),t._v(" Compartments and realms")]),t._v(" "),a("p",[t._v("JavaScript code runs in the context of a "),a("a",{attrs:{href:"https://www.ecma-international.org/ecma-262/10.0/index.html#sec-code-realms",target:"_blank",rel:"noopener noreferrer"}},[a("code",[t._v("Realm")]),a("OutboundLink")],1),t._v(". A realm is composed of the set of "),a("em",[t._v("primordials")]),t._v(" (objects and functions of the standard library like "),a("code",[t._v("Array.prototype.push")]),t._v(") and of a global object. In a web browser, an iframe is a realm. In Node.js, a Node process is a realm.")]),t._v(" "),a("p",[t._v("For historical reasons, the ECMAScript specification requires the "),a("em",[t._v("primordials")]),t._v(" to be mutable ("),a("code",[t._v("Array.prototype.push = yourFunction")]),t._v(" is valid ECMAScript but not recommended). SES provides to turn the current realm into an "),a("strong",[t._v("immutable realm")]),t._v(", that is a realm within which, the primordials are deeply frozen. It also allows to create "),a("strong",[t._v("Compartments")]),t._v(".")]),t._v(" "),a("p",[t._v('Compartments are "mini-realms". They have their own dedicated global object and environement, but they inherit the primordials from their parent realm.')]),t._v(" "),a("p",[t._v('Agoric "deploy scripts" and smart contract code run in an immutable realm with compartments providing just enough authority to create useful and secure contracts (but not enough authority to do anything unintended or harmful to the participants of the smart contract)')]),t._v(" "),a("h3",{attrs:{id:"harden"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#harden"}},[t._v("#")]),t._v(" harden")]),t._v(" "),a("p",[a("code",[t._v("harden")]),t._v(" is a function provided by the "),a("a",{attrs:{href:"https://www.npmjs.com/package/@agoric/harden",target:"_blank",rel:"noopener noreferrer"}},[a("code",[t._v("@agoric/harden")]),t._v(" package"),a("OutboundLink")],1),t._v(".")]),t._v(" "),a("p",[t._v("In a nutshell, "),a("code",[t._v("harden")]),t._v(" creates objects that can be trusted. In practice, "),a("code",[t._v("harden")]),t._v(" performs the deep version of "),a("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/freeze",target:"_blank",rel:"noopener noreferrer"}},[a("code",[t._v("Object.freeze")]),a("OutboundLink")],1),t._v(" (which only freezes the object's own properties).")]),t._v(" "),a("p",[t._v("Most methods of the Agoric platform require their arguments to be "),a("code",[t._v("harden")]),t._v("ed. This is the only way they can provide the security properties they claim to provide.")]),t._v(" "),a("p",[t._v("After you've "),a("a",{attrs:{href:"https://docs.npmjs.com/cli/install",target:"_blank",rel:"noopener noreferrer"}},[t._v("installed"),a("OutboundLink")],1),t._v(" the "),a("a",{attrs:{href:"https://www.npmjs.com/package/@agoric/harden",target:"_blank",rel:"noopener noreferrer"}},[a("code",[t._v("@agoric/harden")]),t._v(" package"),a("OutboundLink")],1),t._v(", you can use it this way:")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" harden "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@agoric/harden'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" o "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("a"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\no"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("a  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("o"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 12 because o is still mutable")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("harden")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("o"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\no"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("a  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("37")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// throws a TypeError because o is now hardened")]),t._v("\n")])])]),a("h3",{attrs:{id:"communicating-with-remote-objects-via-e"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#communicating-with-remote-objects-via-e"}},[t._v("#")]),t._v(" Communicating with remote objects via "),a("code",[t._v("E")])]),t._v(" "),a("p",[t._v("Deploy scripts and smart contracts runs in specific vats and may try to access services that run in a different vat (maybe in a different physical machine or in a blockchain). For instance, a deploy script may want to install a contract in a Zoe instance running in a blockchain. For this to happen, the deploy script cannot call "),a("code",[t._v("zoe.install(code, moduleFormat)")]),t._v(", because it does not have access to the "),a("code",[t._v("zoe")]),t._v(" object because it's in a different.")]),t._v(" "),a("p",[t._v("However, the deploy script is given access to a "),a("code",[t._v("zoe")]),t._v(" "),a("em",[t._v("presence")]),t._v(". In order to call methods on the actual Zoe object, the deploy code can do:")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" installationHandle "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("E")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("zoe"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("source"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" moduleFormat"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("The "),a("code",[t._v("E")]),t._v(' function is a local "bridge" that allows to talk to remote object and call their methods. The local version of a remote object is called a '),a("strong",[t._v("presence")]),t._v(". "),a("code",[t._v("E")]),t._v(" takes a presence as an argument all created an object with the corresponding methods. It performs the communication asynchronously under the hood. Method calls can take arguments that are objects in the current vat or presences to the zoe vat or presences of objects from other vats.")])])}),[],!1,null,null,null);e.default=r.exports}}]);